<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Placar</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        
    <!-- PWA Theme Color -->
    <meta name="theme-color" id="theme-color-meta" content="#059669">

    <style>
        :root {
            --theme-primary: #059669; /* emerald-600 */
            --theme-primary-dark: #047857; /* emerald-700 */
        }
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        html.dark ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 6px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Dynamic Theme Colors */
        .bg-theme-primary { background-color: var(--theme-primary); }
        .dark .bg-theme-primary-dark { background-color: var(--theme-primary-dark); }
        .text-theme-primary { color: var(--theme-primary); }
        .border-theme-primary { border-color: var(--theme-primary); }

        /* Modal Styles */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); z-index: 40;
            display: flex; justify-content: center; align-items: center;
            -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
        }
        .modal-content {
            background-color: white; padding: 24px; border-radius: 8px;
            width: 90%; max-width: 400px; z-index: 50;
        }
        html.dark .modal-content { background-color: #1f2937; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300">

    <div id="app" class="max-w-4xl mx-auto min-h-screen flex flex-col">
        <!-- Header -->
        <header id="app-header" class="bg-theme-primary dark:bg-theme-primary-dark text-white p-4 shadow-lg sticky top-0 z-30 flex justify-between items-center transition-colors duration-500">
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-check"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>
                <h1 class="text-xl font-bold">Meu Placar</h1>
            </div>
            <div class="flex items-center gap-2">
                <button id="notification-button" title="Ativar notifica√ß√µes" class="bg-white/20 hover:bg-white/30 p-2 rounded-full transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
                </button>
                 <button id="edit-team-button" title="Editar time" class="bg-white/20 hover:bg-white/30 p-2 rounded-full transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                </button>
                <button id="install-button" class="hidden bg-white text-emerald-600 font-semibold py-2 px-3 rounded-lg shadow-md hover:bg-gray-100 transition-all duration-200 text-sm flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 17V3"/><path d="m6 11 6 6 6-6"/><path d="M19 21H5"/></svg>
                    Instalar
                </button>
            </div>
        </header>

        <!-- Team Navigation -->
        <nav class="bg-white dark:bg-gray-800 shadow-md sticky top-[76px] z-20">
            <div id="team-nav-container" class="flex justify-around items-center p-2 space-x-1 sm:space-x-2">
                <!-- Tabs will be rendered here by JS -->
            </div>
        </nav>

        <!-- Main Content -->
        <main id="content" class="p-2 sm:p-4 flex-grow">
             <!-- Content will be injected here -->
        </main>
        
        <!-- Footer -->
        <footer class="text-center p-4 text-xs text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700">
            Meu Placar PWA &copy; 2024
        </footer>
    </div>
    
    <!-- Edit Team Modal -->
    <div id="edit-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">Editar Time</h2>
            <div class="space-y-4">
                <div>
                    <label for="team-name-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nome do Time</label>
                    <input type="text" id="team-name-input" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-gray-800 dark:text-gray-200">
                </div>
                <div>
                    <label for="team-logo-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">URL do Escudo</label>
                    <input type="url" id="team-logo-input" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-gray-800 dark:text-gray-200">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-edit-button" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition">Cancelar</button>
                <button id="save-edit-button" class="px-4 py-2 bg-emerald-500 text-white rounded-md hover:bg-emerald-600 transition">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-[-100px] left-1/2 -translate-x-1/2 bg-gray-800 text-white text-sm py-3 px-6 rounded-full shadow-lg transition-all duration-300 z-50">
        <span id="toast-message"></span>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // --- PWA SETUP ---
            setupPWA();

            // --- INITIAL DATA & CONFIG ---
            let teamsData = {
                palmeiras: { id: 'palmeiras', queryName: 'Palmeiras', displayName: 'Palmeiras', sport: 'Futebol', logo: 'https://upload.wikimedia.org/wikipedia/commons/1/10/Palmeiras_logo.svg', theme: { primary: '#006437', primaryDark: '#004C2A' }},
                rio_branco: { id: 'rio_branco', queryName: 'Rio Branco-SP', displayName: 'Rio Branco', sport: 'Futebol', logo: 'https://upload.wikimedia.org/wikipedia/pt/4/48/Riobrancosp.png', theme: { primary: '#212121', primaryDark: '#000000' } },
                packers: { id: 'packers', queryName: 'Green Bay Packers', displayName: 'Packers', sport: 'Futebol Americano', logo: 'https://upload.wikimedia.org/wikipedia/commons/5/50/Green_Bay_Packers_logo.svg', theme: { primary: '#203731', primaryDark: '#FFB612' } },
                brasil: { id: 'brasil', queryName: 'Sele√ß√£o Brasileira de Futebol', displayName: 'Brasil', sport: 'Futebol', logo: 'https://upload.wikimedia.org/wikipedia/pt/b/b9/Logo_CBF_2019.svg', theme: { primary: '#002776', primaryDark: '#FFDF00' } }
            };

            let activeTeamId = 'palmeiras';
            let activeContentTab = 'overview';
            let liveDataCache = {};
            
            const contentEl = document.getElementById('content');
            const navContainer = document.getElementById('team-nav-container');

            // --- DATA PERSONALIZATION (localStorage) ---
            const loadCustomData = () => { try { const d = localStorage.getItem('myPwaTeamsData_v2'); if(d) teamsData = JSON.parse(d); } catch (e) { console.error("Failed to load custom data", e); } };
            const saveCustomData = () => { try { localStorage.setItem('myPwaTeamsData_v2', JSON.stringify(teamsData)); } catch (e) { console.error("Failed to save custom data", e); } };
            
            // --- DYNAMIC THEMING ---
            const applyTheme = (teamId) => {
                const team = teamsData[teamId];
                if (!team || !team.theme) return;
                const root = document.documentElement;
                root.style.setProperty('--theme-primary', team.theme.primary);
                root.style.setProperty('--theme-primary-dark', team.theme.primaryDark);
                document.getElementById('theme-color-meta').setAttribute('content', team.theme.primary);
            };

            // --- UI RENDERING ---
            const renderNavTabs = () => {
                navContainer.innerHTML = '';
                Object.values(teamsData).forEach(team => {
                    const isActive = team.id === activeTeamId;
                    const tab = document.createElement('button');
                    tab.dataset.team = team.id;
                    tab.className = `team-tab flex-1 flex flex-col items-center justify-center p-2 rounded-lg transition-all duration-300 transform hover:scale-105 ${isActive ? 'scale-110' : ''}`;
                    tab.innerHTML = `
                        <div class="p-1 rounded-full ${isActive ? 'bg-gray-200 dark:bg-gray-700' : ''} transition-all duration-300">
                            <img src="${team.logo}" onerror="this.src='https://placehold.co/48x48/CCCCCC/FFFFFF?text=??'" alt="Logo ${team.displayName}" class="w-8 h-8 sm:w-10 sm:h-10 object-contain transition-all duration-300">
                        </div>
                        <span class="text-xs sm:text-sm font-medium mt-1 ${isActive ? 'text-theme-primary font-bold' : 'text-gray-600 dark:text-gray-300'}">${team.displayName}</span>
                    `;
                    tab.addEventListener('click', () => { activeTeamId = team.id; activeContentTab = 'overview'; applyTheme(team.id); renderNavTabs(); renderContent(); });
                    navContainer.appendChild(tab);
                });
            };

            // --- API DATA FETCHING (GEMINI) ---
            const fetchTeamData = async (teamQuery, sport) => {
                const cacheKey = `${teamQuery}-${sport}`;
                if (liveDataCache[cacheKey] && (new Date() - liveDataCache[cacheKey].timestamp < 300000)) { // 5 min cache
                    return liveDataCache[cacheKey].data;
                }
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const prompt = `Busque informa√ß√µes detalhadas e recentes sobre o time de ${sport} "${teamQuery}". Forne√ßa um JSON com a estrutura: { "overview": { "latestResult": { "opponent", "opponentLogo", "score", "championship" }, "nextGame": { "opponent", "opponentLogo", "date", "championship", "whereToWatch" }, "news": [{ "title", "url", "imageUrl" }] }, "standings": [{ "position", "teamName", "logo", "points", "played", "wins", "draws", "losses" }], "squad": [{ "name", "position", "number", "photoUrl" }] }. Para "standings", retorne os 10 primeiros. Para "squad", os 15 principais. Se algo n√£o for encontrado, retorne null.`;

                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], tools: [{ "google_search": {} }], generationConfig: { responseMimeType: "application/json" } }) });
                    if (!response.ok) throw new Error(`API Error: ${response.status}`);
                    const result = await response.json();
                    const jsonText = result.candidates[0].content.parts[0].text;
                    const parsedData = JSON.parse(jsonText);
                    liveDataCache[cacheKey] = { data: parsedData, timestamp: new Date() };
                    return parsedData;
                } catch (error) {
                    console.error("Failed to fetch team data:", error);
                    return null;
                }
            };
            
            // --- MAIN CONTENT & SKELETON RENDERING ---
            const renderSkeleton = () => {
                const skeletonCard = `<div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md animate-pulse"><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4 mb-2"></div><div class="h-3 bg-gray-300 dark:bg-gray-700 rounded w-1/2"></div></div>`;
                const skeletonTable = `<div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md animate-pulse"><div class="h-8 bg-gray-300 dark:bg-gray-700 rounded w-full mb-2"></div><div class="h-8 bg-gray-300 dark:bg-gray-700 rounded w-full"></div></div>`;
                return `<div id="content-tabs" class="mb-4 border-b border-gray-200 dark:border-gray-700"></div><div class="space-y-4">${skeletonCard.repeat(2)}${skeletonTable}</div>`;
            };

            const renderContent = async () => {
                contentEl.innerHTML = renderSkeleton();
                const team = teamsData[activeTeamId];
                const liveData = await fetchTeamData(team.queryName, team.sport);
                
                if (!liveData) {
                    contentEl.innerHTML = `<div class="text-center text-red-500 p-4 bg-red-100 dark:bg-red-900/50 rounded-lg"><h3 class="font-bold">Erro ao buscar dados</h3><p>Tente novamente mais tarde.</p></div>`;
                    return;
                }

                const renderContentTabs = () => {
                    const tabs = { overview: 'Vis√£o Geral', standings: 'Tabela', squad: 'Elenco' };
                    let tabsHtml = '<div class="flex space-x-4">';
                    for (const [key, value] of Object.entries(tabs)) {
                        const isActive = activeContentTab === key;
                        tabsHtml += `<button data-tab="${key}" class="content-tab-button py-2 px-1 font-semibold transition-colors duration-300 ${isActive ? 'border-b-2 border-theme-primary text-theme-primary' : 'text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'}">${value}</button>`;
                    }
                    tabsHtml += '</div>';
                    return tabsHtml;
                };

                const renderSubContent = () => {
                    const { overview, standings, squad } = liveData;
                    let html = '';
                    switch(activeContentTab) {
                        case 'standings':
                            html = `<div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-x-auto"><table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"><tr>
                                    <th scope="col" class="pl-4 pr-2 py-3 text-center">#</th><th scope="col" class="px-2 py-3">Time</th><th scope="col" class="px-2 py-3 text-center">P</th><th scope="col" class="px-2 py-3 text-center">J</th><th scope="col" class="px-2 py-3 text-center">V</th>
                                </tr></thead><tbody>
                                ${standings?.map(row => `<tr class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                    <td class="pl-4 pr-2 py-4 text-center font-medium text-gray-900 dark:text-white">${row.position}</td>
                                    <td scope="row" class="px-2 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap flex items-center gap-2"><img src="${row.logo || 'https://placehold.co/24x24'}" class="w-6 h-6 object-contain"/>${row.teamName}</td>
                                    <td class="px-2 py-4 text-center font-bold">${row.points}</td><td class="px-2 py-4 text-center">${row.played}</td><td class="px-2 py-4 text-center">${row.wins}</td>
                                </tr>`).join('') || '<tr><td colspan="5" class="p-4 text-center">Tabela indispon√≠vel.</td></tr>'}
                                </tbody></table></div>`;
                            break;
                        case 'squad':
                            html = `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                                ${squad?.map(player => `<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-3 text-center">
                                    <img src="${player.photoUrl || 'https://placehold.co/96x96'}" class="w-16 h-16 rounded-full mx-auto mb-2 object-cover border-2 border-gray-200 dark:border-gray-600">
                                    <p class="font-bold text-sm text-gray-900 dark:text-white">${player.name}</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">${player.position}</p>
                                    <p class="text-lg font-black text-theme-primary opacity-50">${player.number || ''}</p>
                                </div>`).join('') || '<p class="col-span-full text-center">Elenco indispon√≠vel.</p>'}
                            </div>`;
                            break;
                        case 'overview': default:
                            const { nextGame, latestResult, news } = overview || {};
                            html = `<div class="space-y-6">
                                ${nextGame ? `<section><h3 class="text-lg font-semibold mb-2 text-gray-700 dark:text-gray-200">Pr√≥ximo Jogo</h3><div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md"><div class="flex items-center justify-around text-center"><div class="w-1/3"><img src="${team.logo}" class="w-12 h-12 mx-auto object-contain"><p class="font-bold mt-1 text-sm">${team.displayName}</p></div><div class="w-1/3"><p class="text-2xl font-bold">VS</p><p class="text-xs text-gray-500">${nextGame.date || ''}</p></div><div class="w-1/3"><img src="${nextGame.opponentLogo || 'https://placehold.co/48x48'}" class="w-12 h-12 mx-auto object-contain"><p class="font-bold mt-1 text-sm">${nextGame.opponent}</p></div></div><p class="text-center text-xs mt-3 text-gray-500 dark:text-gray-400">${nextGame.whereToWatch ? `üì∫ ${nextGame.whereToWatch}` : ''}</p></div></section>` : ''}
                                ${latestResult ? `<section><h3 class="text-lg font-semibold mb-2 text-gray-700 dark:text-gray-200">√öltimo Resultado</h3><div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md flex justify-between items-center"><div><p class="font-medium">${latestResult.opponent}</p><p class="text-xs text-gray-500">${latestResult.championship}</p></div><div class="text-lg font-bold p-2 rounded-md bg-gray-100 dark:bg-gray-700">${latestResult.score}</div></div></section>` : ''}
                                ${news ? `<section><h3 class="text-lg font-semibold mb-2 text-gray-700 dark:text-gray-200">Not√≠cias</h3><div class="space-y-3">${news.map(item => `<a href="${item.url}" target="_blank" rel="noopener noreferrer" class="flex items-center bg-white dark:bg-gray-800 p-3 rounded-lg shadow-md gap-4 hover:shadow-xl transition-shadow"><img src="${item.imageUrl || 'https://placehold.co/80x80'}" class="w-16 h-16 rounded-md object-cover flex-shrink-0"><div class="flex-grow"><p class="font-medium text-sm leading-tight">${item.title}</p></div></a>`).join('')}</div></section>` : ''}
                            </div>`;
                            break;
                    }
                    return `<div class="animate-fade-in">${html}</div>`;
                };

                contentEl.innerHTML = `<div class="mb-4 border-b border-gray-200 dark:border-gray-700">${renderContentTabs()}</div><div id="sub-content">${renderSubContent()}</div>`;
                const style = document.createElement('style'); style.innerHTML = `@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }`;
                contentEl.appendChild(style);

                document.querySelectorAll('.content-tab-button').forEach(btn => btn.addEventListener('click', () => { activeContentTab = btn.dataset.tab; renderContent(); }));
            };

            // --- MODAL & NOTIFICATIONS ---
            const modal = document.getElementById('edit-modal');
            const editBtn = document.getElementById('edit-team-button');
            const cancelBtn = document.getElementById('cancel-edit-button');
            const saveBtn = document.getElementById('save-edit-button');
            const nameInput = document.getElementById('team-name-input');
            const logoInput = document.getElementById('team-logo-input');
            const notificationBtn = document.getElementById('notification-button');
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-message');

            const showToast = (message) => { toastMsg.textContent = message; toast.classList.add('bottom-5'); setTimeout(() => toast.classList.remove('bottom-5'), 3000); };
            editBtn.addEventListener('click', () => { const t = teamsData[activeTeamId]; nameInput.value = t.displayName; logoInput.value = t.logo; modal.classList.remove('hidden'); });
            const closeModal = () => modal.classList.add('hidden');
            cancelBtn.addEventListener('click', closeModal);
            saveBtn.addEventListener('click', () => { teamsData[activeTeamId].displayName = nameInput.value.trim() || teamsData[activeTeamId].displayName; teamsData[activeTeamId].logo = logoInput.value.trim() || teamsData[activeTeamId].logo; saveCustomData(); renderNavTabs(); closeModal(); });
            notificationBtn.addEventListener('click', async () => { if (!('Notification' in window)) { showToast('Notifica√ß√µes n√£o s√£o suportadas.'); return; } if (Notification.permission === 'granted') { showToast('Notifica√ß√µes j√° est√£o ativas!'); } else if (Notification.permission !== 'denied') { const permission = await Notification.requestPermission(); if (permission === 'granted') showToast('Notifica√ß√µes ativadas!'); else showToast('Permiss√£o para notifica√ß√µes negada.'); } else { showToast('Notifica√ß√µes bloqueadas no navegador.'); } });

            // --- INITIALIZATION ---
            loadCustomData();
            applyTheme(activeTeamId);
            renderNavTabs();
            await renderContent();
        });

        function setupPWA() {
            const manifest = { name: "Meu Placar PWA", short_name: "Meu Placar", start_url: ".", display: "standalone", background_color: "#111827", theme_color: "#059669", description: "Acompanhe seus times com dados em tempo real e muito mais.", icons: [{ src: "https://placehold.co/192x192/059669/FFFFFF?text=MP", sizes: "192x192", type: "image/png" }, { src: "https://placehold.co/512x512/059669/FFFFFF?text=MP", sizes: "512x512", type: "image/png" }] };
            const manifestURL = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type: 'application/json'}));
            document.head.appendChild(Object.assign(document.createElement('link'), { rel: 'manifest', href: manifestURL }));
            if ('serviceWorker' in navigator) {
                const swCode = ` const CACHE_NAME = 'meu-placar-cache-v4'; self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.add('/')))); self.addEventListener('fetch', e => e.respondWith(fetch(e.request).catch(() => caches.match(e.request)))); self.addEventListener('activate', e => e.waitUntil(caches.keys().then(names => Promise.all(names.map(name => name !== CACHE_NAME ? caches.delete(name) : null))))); self.addEventListener('push', e => { const data = e.data.json(); e.waitUntil(self.registration.showNotification(data.title, { body: data.body, icon: data.icon })); }); `;
                const swUrl = URL.createObjectURL(new Blob([swCode], {type: 'application/javascript'}));
                navigator.serviceWorker.register(swUrl).then(() => console.log('SW Registered')).catch(e => console.error('SW Error:', e));
            }
            let deferredPrompt;
            const installBtn = document.getElementById('install-button');
            window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; installBtn.classList.remove('hidden'); });
            installBtn.addEventListener('click', async () => { if (!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt = null; installBtn.classList.add('hidden'); });
        }
    </script>
</body>
</html>
