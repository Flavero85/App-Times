<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Placar</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tone.js for Audio Simulation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
        
    <!-- PWA Theme Color -->
    <meta name="theme-color" id="theme-color-meta" content="#111827">

    <style>
        :root {
            --theme-primary: #10B981;
            --theme-background: #111827;
        }
        
        html.light {
            --theme-background: #F3F4F6;
        }

        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: var(--theme-background);
            color: #F9FAFB;
            transition: background-color 0.5s ease-out;
        }

        html.light body {
            color: #1F2937;
        }
        
        .bg-theme-primary { background-color: var(--theme-primary); }
        .text-theme-primary { color: var(--theme-primary); }
        .border-theme-primary { border-color: var(--theme-primary); }
        .fill-theme-primary { fill: var(--theme-primary); }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9) rotate(-4deg); } 
            to { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-scale-in { animation: scaleIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }

        .stagger-children > * { opacity: 0; }
        
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details summary .chevron { transition: transform 0.3s ease-out; }
        details[open] summary .chevron { transform: rotate(90deg); }
        
        @keyframes progress-bar { from { width: 0%; } to { width: 100%; } }
        .progress-bar-fill.playing { animation: progress-bar 5s linear forwards; }

        .modal-content {
            background-color: #2a2a2e;
        }
        html.light .modal-content {
             background-color: #ffffff;
        }
    </style>
</head>
<body id="app-body">

    <div id="app" class="max-w-4xl mx-auto min-h-screen flex flex-col">
        <!-- Header -->
        <header id="app-header" class="bg-black/30 backdrop-blur-sm text-white p-4 sticky top-0 z-40 flex justify-between items-center transition-colors duration-500 border-b border-white/10">
            <div class="flex items-center gap-3">
                <button id="back-button" class="hidden p-2 -ml-2 rounded-full hover:bg-white/10 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="m12 19-7-7 7-7"/></svg>
                </button>
                <div class="flex items-center gap-3" id="header-main-title">
                     <svg id="header-logo" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-theme-primary"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>
                    <h1 id="header-title" class="text-xl font-bold">Meu Placar</h1>
                </div>
            </div>
            <div class="flex items-center gap-2">
                 <button id="settings-button" class="p-2 rounded-full hover:bg-white/10 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                </button>
                <button id="install-button" class="hidden bg-white/90 text-gray-900 font-semibold py-2 px-3 rounded-lg shadow-md hover:bg-white transition-all duration-200 text-sm flex items-center gap-2 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 17V3"/><path d="m6 11 6 6 6-6"/><path d="M19 21H5"/></svg>
                    Instalar
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main id="content" class="p-4 flex-grow">
             <!-- Content will be injected here -->
        </main>
        
        <footer class="text-center p-4 text-xs text-gray-400 border-t border-white/10">
            Meu Placar PWA &copy; 2024
        </footer>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="modal-content w-full max-w-md rounded-xl shadow-lg p-6 animate-fade-in-up text-white">
            <h2 class="text-2xl font-bold mb-6 text-black dark:text-white">Configurações</h2>
            
            <div class="space-y-6">
                <!-- Theme Toggle -->
                <div class="flex items-center justify-between bg-gray-100 dark:bg-black/20 p-4 rounded-lg">
                    <span class="font-semibold text-black dark:text-white">Modo Escuro</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="theme-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-300 dark:bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-theme-primary"></div>
                    </label>
                </div>

                <!-- Edit Teams -->
                <div>
                    <h3 class="font-bold text-lg mb-3 text-black dark:text-white">Editar Times</h3>
                    <div id="edit-teams-list" class="space-y-2">
                        <!-- Team edit buttons will be injected here -->
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-8 border-t border-gray-200 dark:border-white/10 pt-4">
                 <button id="cancel-settings-button" class="bg-gray-200 dark:bg-black/20 text-gray-700 dark:text-gray-300 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-black/40">Cancelar</button>
                 <button id="save-settings-button" class="bg-theme-primary text-white font-semibold py-2 px-4 rounded-lg hover:opacity-90">Salvar e Fechar</button>
             </div>
        </div>
    </div>
    
    <!-- Edit Team Modal -->
    <div id="edit-team-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
        <div class="modal-content w-full max-w-md rounded-xl shadow-lg p-6 animate-fade-in-up">
             <h2 class="text-2xl font-bold text-black dark:text-white mb-4">Editar Time</h2>
             <input type="hidden" id="edit-team-id">
             <div class="space-y-4">
                 <div>
                     <label for="edit-team-name" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1">Nome do Time</label>
                     <input type="text" id="edit-team-name" class="w-full bg-gray-100 dark:bg-black/20 border border-gray-300 dark:border-white/20 text-black dark:text-white rounded-lg p-2 focus:ring-2 focus:ring-theme-primary focus:border-theme-primary outline-none">
                 </div>
                 <div>
                     <label for="edit-team-logo" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1">URL do Escudo</label>
                     <input type="text" id="edit-team-logo" class="w-full bg-gray-100 dark:bg-black/20 border border-gray-300 dark:border-white/20 text-black dark:text-white rounded-lg p-2 focus:ring-2 focus:ring-theme-primary focus:border-theme-primary outline-none">
                 </div>
             </div>
             <div class="flex justify-end gap-3 mt-6">
                 <button id="cancel-edit-button" class="bg-gray-200 dark:bg-black/20 text-gray-700 dark:text-gray-300 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-black/40">Cancelar</button>
                 <button id="save-edit-button" class="bg-theme-primary text-white font-semibold py-2 px-4 rounded-lg hover:opacity-90">Salvar Alteração</button>
             </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setupPWA();

            // --- COMPLETE MOCK DATA (DEFAULT) ---
            const defaultApiData = {
                palmeiras: {
                    overview: { latestResult: { opponent: "Corinthians", score: "2 - 1" }, nextGames: [{ opponent: "Flamengo", date: "Sáb, 20:00", championship: "Brasileirão" }, { opponent: "Boca Juniors", date: "Qua, 21:30", championship: "Libertadores" }, { opponent: "Grêmio", date: "Dom, 16:00", championship: "Brasileirão" }], competitions: ["Campeonato Brasileiro", "Copa Libertadores", "Copa do Brasil", "Campeonato Paulista"], news: [{ title: "Dudu avança na recuperação e pode voltar em breve", url: "#" }, { title: "Abel Ferreira testa novas formações para a Libertadores", url: "#" }, { title: "Endrick brilha e Palmeiras vence no Brasileirão Sub-20", url: "#" }, { title: "Allianz Parque terá novo gramado sintético em 2025", url: "#" }, { title: "Veiga atinge marca histórica de gols", url: "#" }], curiosities: [{ title: "Arrancada Heroica", text: "Em 1942, durante a 2ª Guerra, o clube foi forçado a mudar de nome de Palestra Italia para Palmeiras. A estreia com o novo nome foi justamente na final do Paulistão contra o São Paulo. O Palmeiras entrou em campo com a bandeira do Brasil e venceu por 3-1, garantindo o título no episódio que ficou conhecido como 'Arrancada Heroica'." }, { title: "Academia de Futebol", text: "O Palmeiras teve duas grandes eras conhecidas como 'Academia de Futebol'. A primeira, nos anos 60, e a segunda, nos anos 70, eram esquadrões que jogavam por música, liderados pelo craque Ademir da Guia, o 'Divino'." }, { title: "Representou a Seleção Brasileira", text: "Em 7 de setembro de 1965, a equipe inteira do Palmeiras (jogadores, comissão técnica e até massagista) vestiu a camisa amarela para representar a Seleção Brasileira na inauguração do estádio Mineirão. Venceram o Uruguai por 3-0."},{ title: "São Marcos de Palestra Itália", text: "O goleiro Marcos foi 'canonizado' pela torcida como 'São Marcos' após a defesa milagrosa de pênalti contra o River Plate na semifinal da Libertadores de 1999, um dos títulos mais importantes da história do clube."}]},
                    standings: { "Brasileirão": Array.from({length: 20}, (_, i) => ({ position: i + 1, teamName: i === 2 ? "Palmeiras" : `Time ${i+1}`, logo: i === 2 ? "https://upload.wikimedia.org/wikipedia/commons/1/10/Palmeiras_logo.svg" : ``, p: 70 - i*2, j: 38, v: 20, sg: 30-(i*2) })), "Libertadores": [ { position: 1, teamName: "Palmeiras", p: 16, j: 6, v: 5, sg: 12 }, { position: 2, teamName: "Boca Juniors", p: 11, j: 6, v: 3, sg: 5 } ], "Copa do Brasil": { type: 'knockout', stage: 'Oitavas de Final', opponent: 'Atlético-MG' }},
                    achievements: [{ championship: "Copa Rio (Mundial de Clubes)", years: "1951" }, { championship: "Copa Libertadores", years: "1999, 2020, 2021" }, { championship: "Copa Mercosul", years: "1998" }, { championship: "Recopa Sul-Americana", years: "2022" }, { championship: "Campeonato Brasileiro", years: "1960, 1967 (Taça Brasil), 1967 (Robertão), 1969, 1972, 1973, 1993, 1994, 2016, 2018, 2022, 2023" }, { championship: "Copa do Brasil", years: "1998, 2012, 2015, 2020" }, { championship: "Supercopa do Brasil", years: "2023" }, { championship: "Copa dos Campeões", years: "2000" }, { championship: "Torneio Rio-São Paulo", years: "5 Títulos" }, { championship: "Campeonato Paulista", years: "26 Títulos" }],
                    music: [{ id: 'hino_pal', title: 'Hino Oficial', lyrics: 'Quando surge o alviverde imponente...'}, { id: 'canto1_pal', title: 'Palmeiras, Minha Vida é Você', lyrics: 'E não importa o que digam...'}, { id: 'canto2_pal', title: 'Vamos Ganhar, Porco!', lyrics: 'Vamos ganhar Porco, olê, olê, olê!'}, { id: 'canto3_pal', title: 'Canta e Vibra', lyrics: 'Canta e vibra, a torcida alviverde...'}]
                },
                rio_branco: {
                    overview: { latestResult: { opponent: "Noroeste", score: "0 - 0" }, nextGames: [{ opponent: "XV de Jaú", date: "Dom, 15:00", championship: "Paulista A2" }, { opponent: "Portuguesa Santista", date: "Qua, 20:00", championship: "Paulista A2" }], competitions: ["Campeonato Paulista A2", "Copa Paulista"], news: [{ title: "Rio Branco anuncia novo patrocinador master", url: "#"}, { title: "Planejamento para a Copa Paulista é iniciado", url: "#"}, { title: "Ídolo do clube visita o treino da equipe", url: "#"}], curiosities: [ { title: "O Tigre da Paulista", text: "Fundado em 1913, o Rio Branco Esporte Clube é um dos clubes mais antigos e tradicionais do interior de São Paulo, da cidade de Americana." }, { title: "Clássico RIO-BA", text: "O clube possui uma grande rivalidade com o União Barbarense, da cidade vizinha de Santa Bárbara d'Oeste. O dérbi é conhecido como 'Clássico RIO-BA' e para a cidade."} ]},
                    standings: { "Paulista A2": Array.from({length: 16}, (_, i) => ({ position: i + 1, teamName: i === 7 ? "Rio Branco-SP" : `Time ${i+1}`, logo: i === 7 ? "https://upload.wikimedia.org/wikipedia/pt/4/48/Riobrancosp.png" : ``, p: 25 - i, j: 15, v: 7, sg: 5-(i*2) }))},
                    achievements: [ { championship: "Campeonato Paulista - Série A2", years: "1922, 1923, 1948, 2012" }, { championship: "Campeonato Paulista - Série A3", years: "1968, 2009" }, { championship: "Campeonato Paulista - Segunda Divisão", years: "2020" } ],
                    music: [{ id: 'hino_rb', title: 'Hino Oficial', lyrics: 'Rio Branco, Rio Branco / De glorioso pavilhão...'}, { id: 'canto1_rb', title: 'Eu Sou Tigre', lyrics: 'Eu sou Tigre, com muito orgulho...'}]
                },
                packers: {
                     overview: { latestResult: { opponent: "Chicago Bears", score: "17 - 9" }, nextGames: [{ opponent: "Detroit Lions", date: "Thu, 21:20", championship: "NFL" }, { opponent: "Minnesota Vikings", date: "Dom, 14:00", championship: "NFL" }], competitions: ["NFL"], news: [{ title: "Jordan Love elogiado após vitória no clássico", url: "#"}, { title: "Análise: O que esperar do confronto contra os Lions", url: "#"}], curiosities: [ { title: "Time da Comunidade", text: "O Green Bay Packers é a única franquia esportiva profissional de uma grande liga nos EUA que é propriedade da comunidade, sem fins lucrativos." }, { title: "Cheeseheads", text: "Os fãs são conhecidos como 'Cheeseheads' por usarem chapéus em formato de queijo, uma referência à grande produção de laticínios do estado de Wisconsin."}, { title: "Lambeau Leap", text: "É a famosa tradição em que um jogador dos Packers, após marcar um touchdown em casa, pula nos braços da torcida na primeira fileira da arquibancada."}]},
                    standings: { "NFL": { "NFC North": [ { position: 1, teamName: "Packers", record: "12-5" }, { position: 2, teamName: "Lions", record: "12-5" }, { position: 3, teamName: "Vikings", record: "7-10" } ], "NFC South": [ { position: 1, teamName: "Buccaneers", record: "9-8" }, { position: 2, teamName: "Saints", record: "9-8" }], "AFC North": [ { position: 1, teamName: "Ravens", record: "13-4" }, { position: 2, teamName: "Browns", record: "11-6" }], "AFC South": [ { position: 1, teamName: "Texans", record: "10-7" }, { position: 2, teamName: "Jaguars", record: "9-8" }]}},
                    achievements: [ { championship: "Super Bowl", years: "1966 (I), 1967 (II), 1996 (XXXI), 2010 (XLV)" }, { championship: "Campeonatos da NFL (pré-Super Bowl)", years: "1929, 1930, 1931, 1936, 1939, 1944, 1961, 1962, 1965" }, { championship: "Títulos de Conferência", years: "9" }, { championship: "Títulos de Divisão", years: "22" } ],
                    music: [{ id: 'hino_gb', title: 'Go! You Packers Go!', lyrics: 'Go, you Packers, go and get them...'}, { id: 'canto1_gb', title: 'Go Pack Go!', lyrics: 'Go Pack Go! Go Pack Go!'}, { id: 'canto2_gb', title: 'Bang the Drum All Day', lyrics: 'I dont want to work, I want to bang on the drum all day...'}]
                },
                brasil: {
                     overview: { latestResult: { opponent: "Argentina", score: "0 - 1" }, nextGames: [{ opponent: "Equador", date: "Qua, 21:30", championship: "Eliminatórias" }, { opponent: "Colômbia", date: "Ter, 21:00", championship: "Eliminatórias" }], competitions: ["Eliminatórias Copa do Mundo", "Copa América"], news: [{ title: "Dorival Jr. convoca seleção para próximos jogos", url: "#"}, { title: "Brasil busca recuperação nas Eliminatórias", url: "#"}], curiosities: [ { title: "Único Pentacampeão", text: "O Brasil é a única seleção nacional a ter vencido a Copa do Mundo cinco vezes e a única a ter participado de todas as edições do torneio." }, { title: "A Camisa 'Canarinho'", text: "A famosa camisa amarela foi adotada após a traumática derrota na Copa de 1950 (Maracanaço). Um concurso foi criado para um novo uniforme que usasse as cores da bandeira, e o design de Aldyr Schlee foi o vencedor."}, { title: "Esquadrão de 1970", text: "A Seleção de 1970, com Pelé, Tostão, Rivellino, Jairzinho e Gérson, é considerada por muitos como a maior equipe de futebol de todos os tempos, encantando o mundo com seu futebol arte." }]},
                    standings: { "Eliminatórias": Array.from({length: 10}, (_, i) => ({ position: i + 1, teamName: i === 2 ? "Brasil" : `País ${i+1}`, logo: i === 2 ? "https://upload.wikimedia.org/wikipedia/pt/b/b9/Logo_CBF_2019.svg" : ``, p: 25-i, j: 12, v: 8, sg: 15-i}))},
                    achievements: [ { championship: "Copa do Mundo", years: "1958, 1962, 1970, 1994, 2002" }, { championship: "Copa América", years: "1919, 1922, 1949, 1989, 1997, 1999, 2004, 2007, 2019" }, { championship: "Copa das Confederações", years: "1997, 2005, 2009, 2013" }, { championship: "Ouro Olímpico", years: "2016, 2020"}],
                    music: [{ id: 'hino_bra', title: 'Hino Nacional', lyrics: 'Ouviram do Ipiranga...'}, { id: 'canto1_bra', title: 'Eu Sou Brasileiro', lyrics: 'Eu sou brasileiro, com muito orgulho...'}, { id: 'canto2_bra', title: 'Pra Frente Brasil', lyrics: 'Noventa milhões em ação, pra frente Brasil, do meu coração...'}]
                }
            };
            
            let teamsData;
            let tempTeamsData;
            let activeContentTab = 'overview';
            const contentEl = document.getElementById('content');
            const headerTitleEl = document.getElementById('header-title');
            const headerMainTitle = document.getElementById('header-main-title');
            const backButton = document.getElementById('back-button');
            const settingsButton = document.getElementById('settings-button');
            const settingsModal = document.getElementById('settings-modal');
            const editTeamModal = document.getElementById('edit-team-modal');
            const defaultBg = '#111827';
            let audioContextStarted = false, synth, currentPlayingId = null, progressTimeout = null;

            function loadAndInitializeData() {
                const savedTheme = localStorage.getItem('placarTheme');
                const savedTeams = localStorage.getItem('placarTeamsData');
                document.documentElement.classList.toggle('light', savedTheme === 'light');
                if (savedTeams) {
                    teamsData = JSON.parse(savedTeams);
                } else {
                    teamsData = {
                        palmeiras: { id: 'palmeiras', displayName: 'Palmeiras', logo: 'https://upload.wikimedia.org/wikipedia/commons/1/10/Palmeiras_logo.svg', theme: { primary: '#00B945', background: '#01321A' }, liveData: defaultApiData.palmeiras },
                        rio_branco: { id: 'rio_branco', displayName: 'Rio Branco', logo: 'https://upload.wikimedia.org/wikipedia/pt/4/48/Riobrancosp.png', theme: { primary: '#FFFFFF', background: '#1C1C1C' }, liveData: defaultApiData.rio_branco },
                        packers: { id: 'packers', displayName: 'Packers', logo: 'https://upload.wikimedia.org/wikipedia/commons/5/50/Green_Bay_Packers_logo.svg', theme: { primary: '#FFB612', background: '#182E2B' }, liveData: defaultApiData.packers },
                        brasil: { id: 'brasil', displayName: 'Brasil', logo: 'https://upload.wikimedia.org/wikipedia/pt/b/b9/Logo_CBF_2019.svg', theme: { primary: '#FFDC00', background: '#001A4C' }, liveData: defaultApiData.brasil }
                    };
                }
            }

            function saveAllSettings() {
                localStorage.setItem('placarTheme', document.documentElement.classList.contains('light') ? 'light' : 'dark');
                teamsData = JSON.parse(JSON.stringify(tempTeamsData));
                localStorage.setItem('placarTeamsData', JSON.stringify(teamsData));
            }
            
            const applyTheme = (theme) => {
                document.documentElement.style.setProperty('--theme-primary', theme.primary);
                document.documentElement.style.setProperty('--theme-background', theme.background);
                document.getElementById('theme-color-meta').setAttribute('content', theme.background);
            };

            const updateHeader = (title, showBack = false) => { 
                headerTitleEl.textContent = title;
                headerMainTitle.classList.toggle('hidden', showBack);
                if(!showBack) headerMainTitle.classList.add('animate-fade-in-up');
                backButton.classList.toggle('hidden', !showBack); 
            };
            
            const initAudio = () => { if (audioContextStarted) return; Tone.start(); synth = new Tone.Synth().toDestination(); audioContextStarted = true; };
            const resetPlayerUI = (player) => { if(player) { player.querySelector('.play-icon').classList.remove('hidden'); player.querySelector('.pause-icon').classList.add('hidden'); player.querySelector('.progress-bar-fill').classList.remove('playing'); } };
            const playSound = (songId) => {
                if (!audioContextStarted) initAudio();
                if (currentPlayingId && progressTimeout) { clearTimeout(progressTimeout); const oldPlayer = document.querySelector(`[data-song-id="${currentPlayingId}"]`); resetPlayerUI(oldPlayer); }
                if (currentPlayingId === songId) { currentPlayingId = null; return; }
                currentPlayingId = songId;
                const player = document.querySelector(`[data-song-id="${songId}"]`);
                player.querySelector('.play-icon').classList.add('hidden');
                player.querySelector('.pause-icon').classList.remove('hidden');
                const progressBar = player.querySelector('.progress-bar-fill');
                progressBar.classList.remove('playing'); void progressBar.offsetWidth; progressBar.classList.add('playing');
                synth.triggerAttackRelease("C4", "8n");
                progressTimeout = setTimeout(() => { resetPlayerUI(player); currentPlayingId = null; }, 5000);
            };

            const renderDashboard = () => {
                updateHeader('Meu Placar');
                settingsButton.classList.remove('hidden');
                const isLight = document.documentElement.classList.contains('light');
                applyTheme({ primary: '#10B981', background: isLight ? '#F3F4F6' : defaultBg });
                
                let widgetsHtml = '<div class="grid grid-cols-2 gap-4 stagger-children">';
                Object.values(teamsData).forEach(team => {
                    const bgColor = isLight ? 'bg-white' : 'bg-gray-800/50 backdrop-blur-sm';
                    const textColor = isLight ? 'text-gray-900' : 'text-white';
                    const subTextColor = isLight ? 'text-gray-500' : 'text-gray-300';
                    const borderColor = isLight ? 'border-gray-200' : 'border-white/10';

                    widgetsHtml += `
                        <div data-teamid="${team.id}" class="team-widget ${bgColor} rounded-xl shadow-lg p-4 flex flex-col items-center text-center cursor-pointer hover:shadow-2xl hover:-translate-y-1.5 transition-all duration-300 overflow-hidden" style="border-bottom: 4px solid ${team.theme.primary}">
                            <img src="${team.logo}" alt="${team.displayName}" class="h-16 w-16 object-contain mb-3">
                            <h3 class="font-bold ${textColor}">${team.displayName}</h3>
                            <div class="text-xs ${subTextColor} mt-2 border-t ${borderColor} w-full pt-2">
                                <p class="font-semibold">Último Placar:</p>
                                <p>${team.liveData.overview.latestResult.score} vs ${team.liveData.overview.latestResult.opponent}</p>
                            </div>
                        </div>`;
                });
                widgetsHtml += '</div>';
                contentEl.innerHTML = widgetsHtml;
                contentEl.querySelectorAll('.stagger-children > *').forEach((child, index) => {
                    child.classList.add('animate-scale-in');
                    child.style.animationDelay = `${index * 100 + 200}ms`;
                });
                document.querySelectorAll('.team-widget').forEach(widget => { widget.addEventListener('click', () => renderTeamDetail(widget.dataset.teamid)); });
            };

            const renderTeamDetail = (teamId, activeTab = 'overview', activeSubTab = null) => {
                settingsButton.classList.add('hidden');
                const team = teamsData[teamId];
                activeContentTab = activeTab;
                updateHeader(team.displayName, true);
                applyTheme(team.theme);

                const renderContentTabs = () => `<div class="flex space-x-1 sm:space-x-4 border-b border-white/10 mb-4 overflow-x-auto pb-2">${Object.entries({ overview: 'Visão Geral', standings: 'Tabela', achievements: 'Conquistas', curiosities: 'Curiosidades', music: 'Músicas' }).map(([k,v])=>`<button data-tab="${k}" class="content-tab-button flex-shrink-0 py-2 px-2 font-semibold transition-all duration-300 ${activeContentTab===k?'border-b-2 border-theme-primary text-theme-primary':'text-gray-400 hover:text-white'}">${v}</button>`).join('')}</div>`;

                const renderSubContent = () => {
                    const { overview, standings, achievements, music } = team.liveData;
                    switch(activeContentTab) {
                        case 'standings':
                            const championships = Object.keys(standings);
                            const currentChamp = activeSubTab || championships[0];
                            const data = standings[currentChamp];
                            let subTabsHtml = championships.length > 1 ? '<div class="flex flex-wrap gap-2 mb-4">' + championships.map(champ => `<button data-subtab="${champ}" class="subtab-button text-sm font-semibold px-3 py-1 rounded-full transition-colors ${currentChamp === champ ? 'bg-theme-primary text-white' : 'bg-black/20 text-gray-300 hover:bg-black/40'}">${champ}</button>`).join('') + '</div>' : '';
                            
                            let standingsHtml = `<div class="bg-black/20 rounded-lg shadow-lg overflow-x-auto">`;
                            if (data.type === 'knockout') {
                                standingsHtml += `<div class="p-4 text-center"><p class="font-semibold text-white">Fase Atual: ${data.stage}</p><p class="text-gray-300">Próximo Adversário: ${data.opponent}</p></div>`;
                            } else if (team.id === 'packers') {
                                 let nflTable = '';
                                 for(const [div, teams] of Object.entries(data)) {
                                     nflTable += `<h4 class="font-semibold text-theme-primary mt-2 mb-1 p-2">${div}</h4><table class="w-full text-sm text-left text-gray-300"><tbody>${teams.map(r => `<tr class="border-b border-white/10"><td class="px-2 py-2 font-medium text-white">${r.position}. ${r.teamName}</td><td class="px-2 py-2 text-center font-bold">${r.record}</td></tr>`).join('')}</tbody></table>`;
                                 }
                                 standingsHtml += nflTable;
                            } else {
                                standingsHtml += `<table class="w-full text-sm text-left text-gray-300"><thead class="text-xs text-gray-400 uppercase"><tr><th class="pl-4 pr-2 py-3 text-center">#</th><th class="px-2 py-3">Time</th><th class="px-2 py-3 text-center">P</th><th class="px-2 py-3 text-center">J</th><th class="px-2 py-3 text-center">V</th><th class="px-2 py-3 text-center">SG</th></tr></thead><tbody>${data.map(r => `<tr class="border-b border-white/10 hover:bg-white/5 ${r.teamName.includes(team.displayName)?'bg-theme-primary/10':''}"><td class="pl-4 pr-2 py-4 text-center font-medium">${r.position}</td><td class="px-2 py-4 font-medium whitespace-nowrap flex items-center gap-2"><img src="${r.logo||'https://placehold.co/24x24/374151/9CA3AF?text=?'}" class="w-6 h-6 object-contain"/>${r.teamName}</td><td class="px-2 py-4 text-center font-bold">${r.p}</td><td class="px-2 py-4 text-center">${r.j}</td><td class="px-2 py-4 text-center">${r.v}</td><td class="px-2 py-4 text-center">${r.sg}</td></tr>`).join('')}</tbody></table>`;
                            }
                            standingsHtml += '</div>';
                            return subTabsHtml + standingsHtml;
                        case 'music': return `<div class="space-y-4 stagger-children">${music?.map(song => `<div data-song-id="${song.id}" class="song-player bg-black/20 rounded-lg shadow-md p-4 flex items-center gap-4"><button class="play-pause-btn p-2 bg-black/30 rounded-full text-white hover:bg-theme-primary transition-colors"><svg class="play-icon w-6 h-6 fill-theme-primary" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg><svg class="pause-icon hidden w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg></button><div class="flex-grow"><p class="font-bold text-white">${song.title}</p><p class="text-xs text-gray-400 italic">"${song.lyrics}"</p><div class="w-full bg-black/30 rounded-full h-1.5 mt-2"><div class="progress-bar-fill bg-theme-primary h-1.5 rounded-full"></div></div></div></div>`).join('')}</div>`;
                        case 'achievements': return `<div class="grid grid-cols-1 md:grid-cols-2 gap-4 stagger-children">${achievements?.map(ach => `<div class="bg-black/20 rounded-lg shadow-md p-4 transition-transform hover:-translate-y-1"><h4 class="font-bold text-md text-theme-primary">${ach.championship}</h4><p class="text-xs text-gray-400 break-words mt-1">${ach.years}</p></div>`).join('')}</div>`;
                        case 'curiosities': return `<div class="space-y-4 stagger-children">${overview.curiosities.map(c => `<div class="bg-black/20 p-4 rounded-lg shadow-md transition-transform hover:-translate-y-1"><h4 class="font-bold text-theme-primary">${c.title}</h4><p class="text-sm text-gray-300 mt-1">${c.text}</p></div>`).join('')}</div>`;
                        default: return `<div class="space-y-6 stagger-children"><section><h3 class="text-lg font-semibold mb-2 text-theme-primary">Próximos Jogos</h3><div class="space-y-3">${overview.nextGames.map(game => `<div class="bg-black/20 p-3 rounded-lg shadow-md transition-transform hover:scale-105"><div class="flex items-center justify-between text-center"><div class="w-1/3 flex flex-col items-center gap-1"><img src="${team.logo}" class="w-8 h-8 mx-auto object-contain"><p class="font-bold text-white text-xs">${team.displayName}</p></div><div class="w-1/3"><p class="font-bold text-sm text-white">VS</p><p class="text-xs text-gray-400">${game.date}</p></div><div class="w-1/3 flex flex-col items-center gap-1"><img src="${game.opponentLogo || 'https://placehold.co/32x32'}" class="w-8 h-8 mx-auto object-contain"><p class="font-bold text-white text-xs">${game.opponent}</p></div></div><p class="text-center text-xs mt-2 text-gray-400">${game.championship}</p></div>`).join('')}</div></section><section><h3 class="text-lg font-semibold mb-2 text-theme-primary">Competições</h3><div class="flex flex-wrap gap-2">${overview.competitions.map(comp => `<span class="bg-black/20 text-gray-300 text-xs font-medium px-3 py-1 rounded-full">${comp}</span>`).join('')}</div></section><section><h3 class="text-lg font-semibold mb-2 text-theme-primary">Notícias</h3><div class="space-y-3">${overview.news.map(item => `<a href="${item.url}" class="flex items-center bg-black/20 p-3 rounded-lg shadow-md gap-4 hover:bg-white/10 transition-colors"><img src="${item.imageUrl || 'https://placehold.co/100x100/374151/9CA3AF?text=?'}" class="w-16 h-16 rounded-md object-cover flex-shrink-0"><div class="flex-grow"><p class="font-medium text-sm leading-tight text-white">${item.title}</p></div></a>`).join('')}</div></section></div>`;
                    }
                };
                
                contentEl.innerHTML = `<div>${renderContentTabs()}</div><div id="sub-content">${renderSubContent()}</div>`;
                contentEl.querySelectorAll('.stagger-children > *').forEach((child, index) => { child.style.animationDelay = `${index * 80}ms`; });
                
                document.querySelectorAll('.content-tab-button').forEach(btn => { btn.addEventListener('click', () => renderTeamDetail(teamId, btn.dataset.tab)); });
                if (activeTab === 'standings') { document.querySelectorAll('.subtab-button').forEach(btn => { btn.addEventListener('click', () => renderTeamDetail(teamId, 'standings', btn.dataset.subtab)); }); }
                if (activeTab === 'music') { document.querySelectorAll('.play-pause-btn').forEach(btn => { btn.addEventListener('click', () => { initAudio(); playSound(btn.closest('.song-player').dataset.songId); }); }); }
            };
            
            // --- SETTINGS MODAL LOGIC ---
            function openSettingsModal() {
                tempTeamsData = JSON.parse(JSON.stringify(teamsData));
                document.getElementById('theme-toggle').checked = !document.documentElement.classList.contains('light');
                renderEditTeamsList();
                settingsModal.classList.remove('hidden');
            }
            
            function renderEditTeamsList() {
                 const editList = document.getElementById('edit-teams-list');
                editList.innerHTML = '';
                Object.values(tempTeamsData).forEach(team => {
                    const button = document.createElement('button');
                    const isLight = document.documentElement.classList.contains('light');
                    button.className = `w-full text-left p-3 rounded-lg flex items-center justify-between ${isLight ? 'bg-gray-100 hover:bg-gray-200' : 'bg-black/20 hover:bg-black/40'}`;
                    button.innerHTML = `<div class="flex items-center gap-3">
                        <img src="${team.logo}" class="w-8 h-8 object-contain rounded-full">
                        <span class="font-semibold ${isLight ? 'text-black' : 'text-white'}">${team.displayName}</span>
                    </div>
                    <span class="text-sm ${isLight ? 'text-gray-500' : 'text-gray-400'}">Editar</span>`;
                    button.onclick = () => openEditTeamModal(team.id);
                    editList.appendChild(button);
                });
            }
            function closeSettingsModal() { settingsModal.classList.add('hidden'); }
            function openEditTeamModal(teamId) {
                const team = tempTeamsData[teamId];
                document.getElementById('edit-team-id').value = teamId;
                document.getElementById('edit-team-name').value = team.displayName;
                document.getElementById('edit-team-logo').value = team.logo;
                editTeamModal.classList.remove('hidden');
            }
            function closeEditTeamModal() { editTeamModal.classList.add('hidden'); }
            function saveTeamChanges() {
                const teamId = document.getElementById('edit-team-id').value;
                tempTeamsData[teamId].displayName = document.getElementById('edit-team-name').value;
                tempTeamsData[teamId].logo = document.getElementById('edit-team-logo').value;
                closeEditTeamModal();
                renderEditTeamsList();
            }
            
            // --- EVENT LISTENERS ---
            settingsButton.addEventListener('click', openSettingsModal);
            document.getElementById('save-settings-button').addEventListener('click', () => { saveAllSettings(); closeSettingsModal(); renderDashboard(); });
            document.getElementById('cancel-settings-button').addEventListener('click', () => { loadAndInitializeData(); closeSettingsModal(); });
            document.getElementById('theme-toggle').addEventListener('change', (e) => {
                document.documentElement.classList.toggle('light', !e.target.checked);
            });
            document.getElementById('save-edit-button').addEventListener('click', saveTeamChanges);
            document.getElementById('cancel-edit-button').addEventListener('click', closeEditTeamModal);
            backButton.addEventListener('click', renderDashboard);
            
            // --- INITIALIZATION ---
            loadAndInitializeData();
            renderDashboard();
        });

        function setupPWA() {
            const manifest={name:"Meu Placar PWA",short_name:"Meu Placar",start_url:".",display:"standalone",background_color:"#111827",theme_color:"#111827",icons:[{src:"https://placehold.co/192x192/1F2937/FFFFFF?text=MP",sizes:"192x192",type:"image/png"},{src:"https://placehold.co/512x512/1F2937/FFFFFF?text=MP",sizes:"512x512",type:"image/png"}]},manifestURL=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:"application/json"}));document.head.appendChild(Object.assign(document.createElement("link"),{rel:"manifest",href:manifestURL}));if("serviceWorker"in navigator){const e="const CACHE_NAME = 'meu-placar-cache-v19'; const urlsToCache = ['.']; self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(urlsToCache)))); self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)))); self.addEventListener('activate', e => e.waitUntil(caches.keys().then(names => Promise.all(names.map(name => name !== CACHE_NAME ? caches.delete(name) : null)))));",t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));navigator.serviceWorker.register(t).catch(e=>console.error("SW Error:",e))}let e;const t=document.getElementById("install-button");window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),e=o,t.classList.remove("hidden")}),t.addEventListener("click",async()=>{e&&(e.prompt(),await e.userChoice,e=null,t.classList.add("hidden"))})}
    </script>
</body>
</html>

